<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();
/** @var array $arParams */
/** @var array $arResult */
/** @global CMain $APPLICATION */
/** @global CUser $USER */
/** @global CDatabase $DB */
/** @var CBitrixComponentTemplate $this */
/** @var string $templateName */
/** @var string $templateFile */
/** @var string $templateFolder */
/** @var string $componentPath */
/** @var CBitrixComponent $component */
$this->setFrameMode(true);

$strSectionEdit = CIBlock::GetArrayByID($arParams["IBLOCK_ID"], "SECTION_EDIT");
$strSectionDelete = CIBlock::GetArrayByID($arParams["IBLOCK_ID"], "SECTION_DELETE");
$arSectionDeleteParams = array("CONFIRM" => GetMessage('CT_BCSL_ELEMENT_DELETE_CONFIRM'));


if ('Y' == $arParams['SHOW_PARENT_NAME'] && 0 < $arResult['SECTION']['ID'])
{
    $this->AddEditAction($arResult['SECTION']['ID'], $arResult['SECTION']['EDIT_LINK'], $strSectionEdit);
    $this->AddDeleteAction($arResult['SECTION']['ID'], $arResult['SECTION']['DELETE_LINK'], $strSectionDelete, $arSectionDeleteParams);

    ?><h1
        class="<? echo $arCurView['TITLE']; ?>"
        id="<? echo $this->GetEditAreaId($arResult['SECTION']['ID']); ?>"
    ><a href="<? echo $arResult['SECTION']['SECTION_PAGE_URL']; ?>"><?
        echo (
            isset($arResult['SECTION']["IPROPERTY_VALUES"]["SECTION_PAGE_TITLE"]) && $arResult['SECTION']["IPROPERTY_VALUES"]["SECTION_PAGE_TITLE"] != ""
            ? $arResult['SECTION']["IPROPERTY_VALUES"]["SECTION_PAGE_TITLE"]
            : $arResult['SECTION']['NAME']
        );
    ?></a></h1><?
}

if (0 < $arResult["SECTIONS_COUNT"])
{
?>
<ul class="menu-left" id="site-left-menu">
<?
        $intCurrentDepth = 1;
        $boolFirst = true;
        foreach ($arResult['SECTIONS'] as &$arSection)
        {
            $this->AddEditAction($arSection['ID'], $arSection['EDIT_LINK'], $strSectionEdit);
            $this->AddDeleteAction($arSection['ID'], $arSection['DELETE_LINK'], $strSectionDelete, $arSectionDeleteParams);

            if ($intCurrentDepth < $arSection['RELATIVE_DEPTH_LEVEL'])
            {
                if (0 < $intCurrentDepth)
                    echo "\n",str_repeat("\t", $arSection['RELATIVE_DEPTH_LEVEL']),'<ul>';
            }
            elseif ($intCurrentDepth == $arSection['RELATIVE_DEPTH_LEVEL'])
            {
                if (!$boolFirst)
                    echo '</li>';
            }
            else
            {
                while ($intCurrentDepth > $arSection['RELATIVE_DEPTH_LEVEL'])
                {
                    echo '</li>',"\n",str_repeat("\t", $intCurrentDepth),'</ul>',"\n",str_repeat("\t", $intCurrentDepth-1);
                    $intCurrentDepth--;
                }
                echo str_repeat("\t", $intCurrentDepth-1),'</li>';
            }

            echo (!$boolFirst ? "\n" : ''),str_repeat("\t", $arSection['RELATIVE_DEPTH_LEVEL']);
            $img = CFile::ResizeImageGet($arSection['PICTURE'], array('width'=>146, 'height'=>146), BX_RESIZE_IMAGE_PROPORTIONAL, true);

            ?><li id="<?=$this->GetEditAreaId($arSection['ID']);?>">
                <a href="<? echo $arSection["SECTION_PAGE_URL"]; ?>">
                    <div class="image" style="background-image: url(<?=$img['src']?>);"></div>
                    <span><? echo $arSection["NAME"];?>
                        <?
                        if ($arParams["COUNT_ELEMENTS"])
                        {
                            ?> <span>(<? echo $arSection["ELEMENT_CNT"]; ?>)</span><?
                        }
                        ?>
                    </span>
                </a>
            </li>
            <?

            $intCurrentDepth = $arSection['RELATIVE_DEPTH_LEVEL'];
            $boolFirst = false;
        }

        unset($arSection);

        while ($intCurrentDepth > 1)
        {
            echo '</li>',"\n",str_repeat("\t", $intCurrentDepth),'</ul>',"\n",str_repeat("\t", $intCurrentDepth-1);
            $intCurrentDepth--;
        }
        if ($intCurrentDepth > 0)
        {
            echo '</li>',"\n";
        }

?></ul><br><?
}
?>

<?
$u=$_SERVER[REQUEST_URI];

$u=explode('?',$u);
$u=$u[0];

global $arFilter2;

$arF = Array('IBLOCK_ID'=>$arParams[IBLOCK_ID], "SECTION_PAGE_URL"=>$u);
  $db_list = CIBlockSection::GetList(Array($by=>$order), $arF, true);
$b=0;
  while($ar_result = $db_list->GetNext())
  {
if ($ar_result[SECTION_PAGE_URL]==$u) 
{
$b=10;
$arFilter2[PROPERTY_RAZDEL]=$ar_result[ID];
}
  }

if ($b==0) $arFilter[ID]=1111111111;

?>

<?$APPLICATION->IncludeComponent(
    "bitrix:news.list", 
    "banner", 
    array(
        "DISPLAY_DATE" => "Y",
        "DISPLAY_NAME" => "Y",
        "DISPLAY_PICTURE" => "Y",
        "DISPLAY_PREVIEW_TEXT" => "Y",
        "AJAX_MODE" => "N",
        "IBLOCK_ID" => "79",
        "NEWS_COUNT" => "20",
        "SORT_BY1" => "ACTIVE_FROM",
        "SORT_ORDER1" => "DESC",
        "SORT_BY2" => "SORT",
        "SORT_ORDER2" => "ASC",
        "FILTER_NAME" => "arFilter2",
        "FIELD_CODE" => array(
            0 => "ID",
            1 => "",
        ),
        "PROPERTY_CODE" => array(
            0 => "",
            1 => "DESCRIPTION",
            2 => "",
        ),
        "CHECK_DATES" => "Y",
        "DETAIL_URL" => "",
        "PREVIEW_TRUNCATE_LEN" => "",
        "ACTIVE_DATE_FORMAT" => "d.m.Y",
        "SET_TITLE" => "N",
        "SET_BROWSER_TITLE" => "N",
        "SET_META_KEYWORDS" => "N",
        "SET_META_DESCRIPTION" => "N",
        "SET_STATUS_404" => "N",
        "INCLUDE_IBLOCK_INTO_CHAIN" => "N",
        "ADD_SECTIONS_CHAIN" => "N",
        "HIDE_LINK_WHEN_NO_DETAIL" => "N",
        "PARENT_SECTION" => "",
        "PARENT_SECTION_CODE" => "",
        "INCLUDE_SUBSECTIONS" => "N",
        "CACHE_TYPE" => "A",
        "CACHE_TIME" => "3600",
        "CACHE_FILTER" => "N",
        "CACHE_GROUPS" => "N",
        "DISPLAY_TOP_PAGER" => "N",
        "DISPLAY_BOTTOM_PAGER" => "N",
        "PAGER_TITLE" => "Новости",
        "PAGER_SHOW_ALWAYS" => "N",
        "PAGER_TEMPLATE" => "arrows",
        "PAGER_DESC_NUMBERING" => "N",
        "PAGER_DESC_NUMBERING_CACHE_TIME" => "36000",
        "PAGER_SHOW_ALL" => "N",
        "AJAX_OPTION_JUMP" => "N",
        "AJAX_OPTION_STYLE" => "N",
        "AJAX_OPTION_HISTORY" => "N",
        "AJAX_OPTION_ADDITIONAL" => "",
        "COMPONENT_TEMPLATE" => "banner",
        "IBLOCK_TYPE" => "-"
    ),
    false
);?>

<br>

